<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <title>codenames</title>
  <style>

    .grid {
      width: 80vw;
      max-width: 600px;
      aspect-ratio: 1;

      display: flex;
      flex-wrap: wrap;
      align-content: space-between;
      justify-content: space-between;
    }

    .grid > div {      
      width: 19%;
      aspect-ratio: 1;

      border: 2px solid #ccc;

      display: flex;
      justify-content: center;
      align-items: center;
      
    }

  </style>
</head>

<body style="background-color: #f5f5f5">

  <script src="/socket.io/socket.io.js"></script>
  
  <script>
    const socket = io();

    // choose random character from the cast of The Room (2003)
    document.addEventListener('DOMContentLoaded', function() {
      const characters = ["Johnny", "Lisa", "Mark", "Denny", "Michelle", "Chris-R", "Steven", "Claudette", "Mike", "Peter", "Florist", "Doggy"];
      var randomCharacter = characters[Math.floor(Math.random() * characters.length)];
      // set default room and user
      document.getElementById('room_id').value = "theRoom";
      document.getElementById('user_name').value = randomCharacter;
    });


    socket.on('roomUpdate', (data) => {

      // assassin is coloring[0]
      // red cards is coloring[1..9]
      // blue cards is coloring[10..17]
      // neutral is coloring[18..25]
      document.getElementById('grid-container').innerHTML = '';
      data.codenames.forEach((str, i) => {
        let index = data.coloring.indexOf(i);
        let color1 = data.revealed[i] ? (index == 0 ? "#242424" : (index >= 1 && index <= 9 ? "#d15656" : (index >= 10 && index <= 17 ? "#5666d1" : "#8c8c8c"))) : "white";
        let color2 = data.revealed[i] ? "white" : "black";
        document.getElementById('grid-container').innerHTML += `<div class="grid-item" id="${i}" style="background-color: ${color1}; color: ${color2}"><b>${str}</b></div>`;
      });

      // show room info
      let admins = data.admins.map(a => `<span class="member-item" id="${a}">${a}ðŸ‘‘</span>`);
      let members = data.members.filter(m => !data.admins.includes(m)).map(m => `<span class="member-item" id="${m}">${m}</span>`);
      document.getElementById('room_info').innerHTML = `<b>${data.id}</b><br/>admins: ${admins.join(', ')}<br/>others: ${members.join(', ')}</span>`;

      // reveal card upon click
      Array.from(document.getElementsByClassName("grid-item")).forEach((c) => {
        c.addEventListener('click', (e) => { socket.emit('revealCards', [e.target.id]); });
      });
      
      // make admin upon click
      Array.from(document.getElementsByClassName("member-item")).forEach((m) => {
        m.addEventListener('click', (e) => { socket.emit('makeAdmin', e.target.id); });
      });

    });

    socket.on('userUpdate', (data) => {
      // show user info
      document.getElementById('user_info').innerHTML = `Hello <b>${data.user}</b>, in room <b>${data.room}</b>`;
    });

    function joinRoom() {
      socket.emit('joinRoom', { 'room_id': document.getElementById('room_id').value, 'user_name': document.getElementById('user_name').value });
    }

    function toggleSpymaster() {
      if (document.getElementsByClassName('grid-item')[0].style.backgroundColor == "white") {
        document.getElementById('grid-container').innerHTML = this.colored_field;
      } else {
        document.getElementById('grid-container').innerHTML = this.uncolored_field;
      }
    }    

  </script>

  <div class="d-flex justify-content-center flex-wrap">
    <div class="mx-2 mb-2" style="width: 600px">
      <h1>Codenames</h1>

      <div class="mx-2 mb-2">
        <label for="room_id">room</label>
        <input id="room_id" maxlength="8" value="" autocomplete="off" />
        
        <label for="user_name">user</label>
        <input id="user_name" maxlength="8" value="" autocomplete="off" />
        
        <button onclick="joinRoom()">join</button>

        <div class="mx-2 mb-2">
          <span id="user_info"></span>
        </div>

        
        <button onclick="toggleSpymaster()" id="toggle_colors">toggle admin view</button>
        <button onclick="socket.emit('reinitGame')" id="reinit_game">reinit game</button>
        <button onclick="socket.emit('revealCards', [...Array(25).keys()])" id="reveal_all">reveal all</button>

      </div>

      <hr/>

      <div class="mx-2 mb-2 d-flex justify-content-center">
        <div class="grid" id="grid-container"></div>
      </div>

      <hr/>

      <div class="mx-2 mb-2"></div>
        <span id="room_info"></span>
      </div>

    </div>

  </div>

</body>

</html>